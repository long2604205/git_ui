<template>
  <base-form
    ref="openRepositoryForm"
    v-model="visible"
    title="Open Repository">
    <template #content>
      <div class="mb-3">
        <label for="clone-path" class="form-label">Repository Path</label>
        <div class="input-group">
          <input v-model="pathRepositories" type="text" class="form-control" id="clone-path" placeholder="Local directory path">
          <button
            class="btn btn-open-local"
            type="button"
            id="browse-clone"
            @click="chooseFolder">
            <i class="fas fa-folder-open"></i>
          </button>
        </div>
      </div>
    </template>
    <template #footer>
      <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">Cancel</button>
      <button
        type="button"
        class="btn btn-clone"
        id="clone-repo-confirm"
        @click="openRepository"
      >
        <span>Open</span>
      </button>
    </template>
  </base-form>
</template>

<script setup>
import { ref } from 'vue'
import BaseForm from '@/components/modals/BaseForm.vue'
import api from '@/plugins/api.js'
import mitter from '@/plugins/mitter.js'

const openRepositoryForm = ref(null)
const visible = ref(false)
const pathRepositories = ref('')

const chooseFolder = async () => {
  const selected = await window.electronAPI?.selectFolder()
  if (selected) {
    pathRepositories.value = selected
  }
}

function openRepository (){
  handleOpenRepo(pathRepositories.value)
  openRepositoryForm.value?.close()
  // mitter.emit('open-repository', pathRepositories.value)
}
async function handleOpenRepo(repoPath) {
  try {
    const response = await api.post('/git/open-repository', {
      repo_path: repoPath
    });

    console.log(response.data.data)
    const result = response.data.data

    if (result) {
      mitter.emit('open-repository', result)

    } else {
      console.error('❌ Failed to open repository: No data returned');
    }

  } catch (error) {
    console.error('❌ Error opening repository:', error.message);
  }
}
</script>
<style scoped>
*{
  font-size: 14px;
}
 .btn-cancel, .btn-clone, .btn-clone:disabled {
  background: var(--bg-tertiary);
  color: var(--text-secondary);
  border: var(--bg-tertiary);
  font-size: 14px;
  font-weight: 500;
}
.btn-clone:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}
.btn-cancel:hover {
  background: var(--bs-red);
  color: var(--text-primary);
}

input {
  background-color: var(--bg-secondary);
  border: 1px solid var(--border-color);
  color: var(--text-primary);
  font-size: 14px;
  resize: none;
  min-height: 80%;
}

input::placeholder {
  color: var(--text-muted);
}

input:focus {
  background-color: var(--bg-secondary);
  color: var(--text-primary);
  box-shadow: none;
}

input:focus-visible {
  outline: none;
  border: 1px solid var(--border-color);
}

.btn-open-local {
  background: var(--bg-tertiary);
  color: var(--text-secondary);
  border: var(--bg-tertiary);
  font-size: 14px;
  font-weight: 500;
}

.btn-open-local:hover {
  background: var(--bg-tertiary);
}
</style>
